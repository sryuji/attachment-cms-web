var Z=Object.defineProperty;var ee=(a,s,f)=>s in a?Z(a,s,{enumerable:!0,configurable:!0,writable:!0,value:f}):a[s]=f;var m=(a,s,f)=>(ee(a,typeof s!="symbol"?s+"":s,f),f);(function(a,s){typeof exports=="object"&&typeof module!="undefined"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(a=typeof globalThis!="undefined"?globalThis:a||self,s(a.AttachmentCMS={}))})(this,function(a){"use strict";var s=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},f="Expected a function",M=0/0,A="[object Symbol]",H=/^\s+|\s+$/g,I=/^[-+]0x[0-9a-f]+$/i,$=/^0b[01]+$/i,B=/^0o[0-7]+$/i,R=parseInt,N=typeof s=="object"&&s&&s.Object===Object&&s,P=typeof self=="object"&&self&&self.Object===Object&&self,W=N||P||Function("return this")(),F=Object.prototype,_=F.toString,D=Math.max,U=Math.min,C=function(){return W.Date.now()};function q(n,e,t){var i,o,u,h,c,d,b=0,L=!1,g=!1,v=!0;if(typeof n!="function")throw new TypeError(f);e=k(e)||0,p(t)&&(L=!!t.leading,g="maxWait"in t,u=g?D(k(t.maxWait)||0,e):u,v="trailing"in t?!!t.trailing:v);function w(r){var l=i,y=o;return i=o=void 0,b=r,h=n.apply(y,l),h}function J(r){return b=r,c=setTimeout(T,e),L?w(r):h}function K(r){var l=r-d,y=r-b,O=e-l;return g?U(O,u-y):O}function S(r){var l=r-d,y=r-b;return d===void 0||l>=e||l<0||g&&y>=u}function T(){var r=C();if(S(r))return x(r);c=setTimeout(T,K(r))}function x(r){return c=void 0,v&&i?w(r):(i=o=void 0,h)}function Q(){c!==void 0&&clearTimeout(c),b=0,i=d=o=c=void 0}function Y(){return c===void 0?h:x(C())}function E(){var r=C(),l=S(r);if(i=arguments,o=this,d=r,l){if(c===void 0)return J(d);if(g)return c=setTimeout(T,e),w(d)}return c===void 0&&(c=setTimeout(T,e)),h}return E.cancel=Q,E.flush=Y,E}function G(n,e,t){var i=!0,o=!0;if(typeof n!="function")throw new TypeError(f);return p(t)&&(i="leading"in t?!!t.leading:i,o="trailing"in t?!!t.trailing:o),q(n,e,{leading:i,maxWait:e,trailing:o})}function p(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function V(n){return!!n&&typeof n=="object"}function X(n){return typeof n=="symbol"||V(n)&&_.call(n)==A}function k(n){if(typeof n=="number")return n;if(X(n))return M;if(p(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=p(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(H,"");var t=$.test(n);return t||B.test(n)?R(n.slice(2),t?2:8):I.test(n)?M:+n}var z=G;class j{constructor(e){m(this,"url");m(this,"token");m(this,"contents");m(this,"id");m(this,"contentsResponse");if(!e||!e.token)throw new Error("Required token.");const t=e&&e.baseUrl||"https://attachment-cms.dev",o=new URLSearchParams(window.location.search).get("token");o?(this.token=o,this.url=`${t}/contents/limited`):(this.token=e.token,this.url=`${t}/contents`),this.id=e&&e.id||null}async run(){this.contentsResponse=await this.fetchContents(),this.contents=this.extractMatchedContents(this.contentsResponse.contents),document.readyState==="loading"?window.addEventListener("DOMContentLoaded",()=>{this.applyContents(),this.observeElement(),this.observeHistoryState()}):(this.applyContents(),this.observeElement(),this.observeHistoryState())}async fetchContents(){const e=`${this.url}?token=${this.token}`;return(await fetch(e)).json()}extractMatchedContents(e){if(!e)return[];const t=Object.keys(e),i=window.location.pathname;return t.filter(o=>{const u=new RegExp(String.raw`^${o}$`,"i");return i.match(u)}).map(o=>e[o]).flat()}observeElement(){const e=this.id?document.getElementById(this.id):document.getElementsByTagName("body")[0];if(!e){this.id&&console.warn(`No exists html element. id: ${this.id}`);return}const t=new MutationObserver(()=>{z(this.applyContents,1e3)}),i={attributes:!1,attributeOldValue:!1,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0};t.observe(e,i)}applyContents(){this.contents.forEach(e=>{const t=document.querySelector(e.selector);if(!!t)switch(e.content&&!e.content.startsWith("<")&&(e.content=`<div>${e.content}</div>`),e.action){case"innerHTML":if(t.innerHTML===e.content)return;t.innerHTML=e.content;break;case"remove":t.parentNode.removeChild(t);break;case"insertBefore":this.insertBeforeElement(t,e.content);break;case"insertChildAfterBegin":this.insertFirstChildToElement(t,e.content);break;case"insertChildBeforeEnd":this.insertLastChildToElement(t,e.content);break;case"insertAfter":this.insertAfterElement(t,e.content);break}})}insertBeforeElement(e,t){const i=e.previousSibling;i&&i.innerHTML===t||e.insertAdjacentHTML("beforebegin",t)}insertFirstChildToElement(e,t){const i=e.firstChild;i&&i.innerHTML===t||e.insertAdjacentHTML("afterbegin",t)}insertLastChildToElement(e,t){const i=e.lastChild;i&&i.innerHTML===t||e.insertAdjacentHTML("beforeend",t)}insertAfterElement(e,t){const i=e.lastChild;i&&i.innerHTML===t||e.insertAdjacentHTML("afterend",t)}observeHistoryState(){window.onpopstate=()=>{this.contents=this.extractMatchedContents(this.contentsResponse.contents),this.applyContents()}}}typeof window!="undefined"&&window.AttachmentConfig&&new j(window.AttachmentConfig).run(),a.AttachmentCMS=j,Object.defineProperty(a,"__esModule",{value:!0}),a[Symbol.toStringTag]="Module"});
