var d=Object.defineProperty;var l=(o,n,s)=>n in o?d(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s;var i=(o,n,s)=>(l(o,typeof n!="symbol"?n+"":n,s),s);(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n(o.AttachmentCMS={}))})(this,function(o){"use strict";class n{constructor(e,t){i(this,"url");i(this,"token");i(this,"contents");const a=new URLSearchParams(window.location.search).get("token");a?(this.token=a,this.url=t?`${t}/contents/limited`:"https://attachment-cms.dev/contents/limited"):(this.token=e,this.url=t?`${t}/contents`:"https://attachment-cms.dev/contents")}async run(){await this.fetchContents(),document.readyState==="loading"?window.addEventListener("DOMContentLoaded",()=>{this.applyContents(),this.observeElement()}):(this.applyContents(),this.observeElement())}async fetchContents(){const e=`${this.url}?token=${this.token}`,c=await(await fetch(e)).json();this.contents=this.extractMatchedContents(c)}extractMatchedContents(e){const t=Object.keys(e),c=window.location.pathname;return t.filter(a=>{const r=new RegExp(String.raw`^${a}$`,"i");return c.match(r)}).map(a=>e[a]).flat()}observeElement(){const e=document.getElementsByTagName("body")[0];console.log(e);const t=new MutationObserver(a=>{console.log(a),this.applyContents()}),c={attributes:!1,attributeOldValue:!1,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0};t.observe(e,c)}applyContents(){this.contents.forEach(e=>{const t=document.querySelector(e.selector);if(!!t)switch(e.action){case"innerHTML":t.innerHTML=e.content;break;case"remove":t.parentNode.removeChild(t);break;case"insertBefore":t.insertAdjacentHTML("beforebegin",e.content);break;case"insertChildAfterBegin":t.insertAdjacentHTML("afterbegin",e.content);break;case"insertChildBeforeEnd":t.insertAdjacentHTML("beforeend",e.content);break;case"insertAfter":t.insertAdjacentHTML("afterend",e.content);break}})}}if(window.AttachmentConfig){const{url:s,token:e}=window.AttachmentConfig;new n(e,s).run()}o.AttachmentCMS=n,Object.defineProperty(o,"__esModule",{value:!0}),o[Symbol.toStringTag]="Module"});
