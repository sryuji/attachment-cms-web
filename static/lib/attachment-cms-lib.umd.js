var d=Object.defineProperty;var h=(o,n,s)=>n in o?d(o,n,{enumerable:!0,configurable:!0,writable:!0,value:s}):o[n]=s;var i=(o,n,s)=>(h(o,typeof n!="symbol"?n+"":n,s),s);(function(o,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(o=typeof globalThis!="undefined"?globalThis:o||self,n(o.AttachmentCMS={}))})(this,function(o){"use strict";class n{constructor(t,e){i(this,"url");i(this,"token");i(this,"contents");const a=new URLSearchParams(window.location.search).get("token");a?(this.token=a,this.url=e?`${e}/contents/limited`:"https://attachment-cms.dev/contents/limited"):(this.token=t,this.url=e?`${e}/contents`:"https://attachment-cms.dev/contents")}async run(){await this.fetchContents(),document.readyState==="loading"?window.addEventListener("DOMContentLoaded",()=>{this.applyContents(),this.observeElement()}):(this.applyContents(),this.observeElement())}async fetchContents(){const t=`${this.url}?token=${this.token}`,c=await(await fetch(t)).json();this.contents=this.extractMatchedContents(c.contents)}extractMatchedContents(t){const e=Object.keys(t),c=window.location.pathname;return e.filter(a=>{const r=new RegExp(String.raw`^${a}$`,"i");return c.match(r)}).map(a=>t[a]).flat()}observeElement(){const t=document.getElementsByTagName("body")[0],e=new MutationObserver(a=>{console.log(a),this.applyContents()}),c={attributes:!1,attributeOldValue:!1,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0};e.observe(t,c)}applyContents(){this.contents.forEach(t=>{const e=document.querySelector(t.selector);if(!!e)switch(t.action){case"innerHTML":e.innerHTML=t.content;break;case"remove":e.parentNode.removeChild(e);break;case"insertBefore":e.insertAdjacentHTML("beforebegin",t.content);break;case"insertChildAfterBegin":e.insertAdjacentHTML("afterbegin",t.content);break;case"insertChildBeforeEnd":e.insertAdjacentHTML("beforeend",t.content);break;case"insertAfter":e.insertAdjacentHTML("afterend",t.content);break}})}}if(window.AttachmentConfig){const{url:s,token:t}=window.AttachmentConfig;new n(t,s).run()}o.AttachmentCMS=n,Object.defineProperty(o,"__esModule",{value:!0}),o[Symbol.toStringTag]="Module"});
