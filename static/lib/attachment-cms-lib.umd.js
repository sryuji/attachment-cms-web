var Z=Object.defineProperty;var ee=(o,s,d)=>s in o?Z(o,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):o[s]=d;var u=(o,s,d)=>(ee(o,typeof s!="symbol"?s+"":s,d),d);(function(o,s){typeof exports=="object"&&typeof module!="undefined"?s(exports):typeof define=="function"&&define.amd?define(["exports"],s):(o=typeof globalThis!="undefined"?globalThis:o||self,s(o.AttachmentCMS={}))})(this,function(o){"use strict";var s=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},d="Expected a function",E=0/0,O="[object Symbol]",H=/^\s+|\s+$/g,I=/^[-+]0x[0-9a-f]+$/i,B=/^0b[01]+$/i,$=/^0o[0-7]+$/i,R=parseInt,q=typeof s=="object"&&s&&s.Object===Object&&s,N=typeof self=="object"&&self&&self.Object===Object&&self,P=q||N||Function("return this")(),U=Object.prototype,F=U.toString,W=Math.max,D=Math.min,C=function(){return P.Date.now()};function _(n,e,t){var i,a,h,m,c,l,b=0,L=!1,g=!1,v=!0;if(typeof n!="function")throw new TypeError(d);e=M(e)||0,p(t)&&(L=!!t.leading,g="maxWait"in t,h=g?W(M(t.maxWait)||0,e):h,v="trailing"in t?!!t.trailing:v);function w(r){var f=i,y=a;return i=a=void 0,b=r,m=n.apply(y,f),m}function z(r){return b=r,c=setTimeout(T,e),L?w(r):m}function J(r){var f=r-l,y=r-b,A=e-f;return g?D(A,h-y):A}function S(r){var f=r-l,y=r-b;return l===void 0||f>=e||f<0||g&&y>=h}function T(){var r=C();if(S(r))return j(r);c=setTimeout(T,J(r))}function j(r){return c=void 0,v&&i?w(r):(i=a=void 0,m)}function K(){c!==void 0&&clearTimeout(c),b=0,i=l=a=c=void 0}function Y(){return c===void 0?m:j(C())}function k(){var r=C(),f=S(r);if(i=arguments,a=this,l=r,f){if(c===void 0)return z(l);if(g)return c=setTimeout(T,e),w(l)}return c===void 0&&(c=setTimeout(T,e)),m}return k.cancel=K,k.flush=Y,k}function G(n,e,t){var i=!0,a=!0;if(typeof n!="function")throw new TypeError(d);return p(t)&&(i="leading"in t?!!t.leading:i,a="trailing"in t?!!t.trailing:a),_(n,e,{leading:i,maxWait:e,trailing:a})}function p(n){var e=typeof n;return!!n&&(e=="object"||e=="function")}function Q(n){return!!n&&typeof n=="object"}function V(n){return typeof n=="symbol"||Q(n)&&F.call(n)==O}function M(n){if(typeof n=="number")return n;if(V(n))return E;if(p(n)){var e=typeof n.valueOf=="function"?n.valueOf():n;n=p(e)?e+"":e}if(typeof n!="string")return n===0?n:+n;n=n.replace(H,"");var t=B.test(n);return t||$.test(n)?R(n.slice(2),t?2:8):I.test(n)?E:+n}var X=G;class x{constructor(e){u(this,"baseUrl");u(this,"defaultToken");u(this,"queryToken");u(this,"contents");u(this,"id");u(this,"contentsResponse");if(!e||!e.token)throw new Error("Required acmst query parameter as token.");this.baseUrl=e&&e.baseUrl||"https://api.attachment-cms.dev",this.defaultToken=e.token,this.id=e&&e.id||null}get isClient(){return typeof window=="undefined"}get url(){return this.queryToken?`${this.baseUrl}/contents/limited`:`${this.baseUrl}/contents`}get token(){return this.queryToken||this.defaultToken}async run(){this.isClient||(this.queryToken=this.getQueryToken(),this.showLimitedMode(),this.contentsResponse=await this.fetchContents(),this.contents=this.extractMatchedContents(this.contentsResponse.contents),document.readyState==="loading"?window.addEventListener("DOMContentLoaded",()=>{this.applyContents(),this.observeElement(),this.observeHistoryState()}):(this.applyContents(),this.observeElement(),this.observeHistoryState()))}getQueryToken(){let e=sessionStorage.getItem("acmst");return e||(e=new URLSearchParams(window.location.search).get("acmst"),e&&sessionStorage.setItem("acmst",e),e)}showLimitedMode(){if(!this.queryToken)return;const e=document.getElementsByTagName("body")[0],t=`<div style="position: fixed; bottom: 20px; right: 30px;background-color: #46F28D; box-shadow: 0 10px 25px 0 rgba(0, 0, 0, .5); border-radius: 6px;">
    <p style="padding: 10px; font-weight: 600;">\u9650\u5B9A\u516C\u958B<br/>by attachment CMS</p>
    </div>`;this.insertLastChildToElement(e,t)}async fetchContents(){const e=`${this.url}?token=${this.token}`;return(await fetch(e)).json()}extractMatchedContents(e){if(!e)return[];const t=Object.keys(e),i=window.location.pathname;return t.filter(a=>{const h=new RegExp(String.raw`^${a}$`,"i");return i.match(h)}).map(a=>e[a]).flat()}observeElement(){const e=this.id?document.getElementById(this.id):document.getElementsByTagName("body")[0];if(!e){this.id&&console.warn(`No exists html element. id: ${this.id}`);return}const t=new MutationObserver(()=>{X(this.applyContents,1e3)}),i={attributes:!1,attributeOldValue:!1,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0};t.observe(e,i)}applyContents(){this.contents.forEach(e=>{const t=document.querySelector(e.selector);if(!!t)switch(e.content&&!e.content.startsWith("<")&&(e.content=`<div>${e.content}</div>`),e.action){case"innerHTML":if(t.innerHTML===e.content)return;t.innerHTML=e.content;break;case"remove":t.parentNode.removeChild(t);break;case"insertBefore":this.insertBeforeElement(t,e.content);break;case"insertChildAfterBegin":this.insertFirstChildToElement(t,e.content);break;case"insertChildBeforeEnd":this.insertLastChildToElement(t,e.content);break;case"insertAfter":this.insertAfterElement(t,e.content);break}})}insertBeforeElement(e,t){const i=e.previousSibling;i&&i.innerHTML===t||e.insertAdjacentHTML("beforebegin",t)}insertFirstChildToElement(e,t){const i=e.firstChild;i&&i.innerHTML===t||e.insertAdjacentHTML("afterbegin",t)}insertLastChildToElement(e,t){const i=e.lastChild;i&&i.innerHTML===t||e.insertAdjacentHTML("beforeend",t)}insertAfterElement(e,t){const i=e.lastChild;i&&i.innerHTML===t||e.insertAdjacentHTML("afterend",t)}observeHistoryState(){window.onpopstate=()=>{this.contents=this.extractMatchedContents(this.contentsResponse.contents),console.log("observeHistoryState",this.contents),this.applyContents()}}}typeof window!="undefined"&&window.AttachmentConfig&&new x(window.AttachmentConfig).run(),o.AttachmentCMS=x,Object.defineProperty(o,"__esModule",{value:!0}),o[Symbol.toStringTag]="Module"});
