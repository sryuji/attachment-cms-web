var h=Object.defineProperty;var d=(s,n,o)=>n in s?h(s,n,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[n]=o;var r=(s,n,o)=>(d(s,typeof n!="symbol"?n+"":n,o),o);(function(s,n){typeof exports=="object"&&typeof module!="undefined"?n(exports):typeof define=="function"&&define.amd?define(["exports"],n):(s=typeof globalThis!="undefined"?globalThis:s||self,n(s.AttachmentCMS={}))})(this,function(s){"use strict";class n{constructor(e){r(this,"url");r(this,"token");r(this,"contents");r(this,"id");r(this,"contentsResponse");if(!e||!e.token)throw new Error("Required token.");const t=e&&e.baseUrl||"https://attachment-cms.dev",i=new URLSearchParams(window.location.search).get("token");i?(this.token=i,this.url=`${t}/contents/limited`):(this.token=e.token,this.url=`${t}/contents`),this.id=e&&e.id||null}async run(){this.contentsResponse=await this.fetchContents(),this.contents=this.extractMatchedContents(this.contentsResponse.contents),document.readyState==="loading"?window.addEventListener("DOMContentLoaded",()=>{this.applyContents(),this.observeElement(),this.observeHistoryState()}):(this.applyContents(),this.observeElement(),this.observeHistoryState())}async fetchContents(){const e=`${this.url}?token=${this.token}`;return(await fetch(e)).json()}extractMatchedContents(e){if(!e)return[];const t=Object.keys(e),a=window.location.pathname;return t.filter(i=>{const c=new RegExp(String.raw`^${i}$`,"i");return a.match(c)}).map(i=>e[i]).flat()}observeElement(){const e=this.id?document.getElementById(this.id):document.getElementsByTagName("body")[0];if(!e){this.id&&console.warn(`No exists html element. id: ${this.id}`);return}const t=new MutationObserver(()=>this.applyContents()),a={attributes:!1,attributeOldValue:!1,characterData:!0,characterDataOldValue:!0,childList:!0,subtree:!0};t.observe(e,a)}applyContents(){this.contents.forEach(e=>{const t=document.querySelector(e.selector);if(!!t)switch(e.action){case"innerHTML":t.innerHTML=e.content;break;case"remove":t.parentNode.removeChild(t);break;case"insertBefore":t.insertAdjacentHTML("beforebegin",e.content);break;case"insertChildAfterBegin":t.insertAdjacentHTML("afterbegin",e.content);break;case"insertChildBeforeEnd":t.insertAdjacentHTML("beforeend",e.content);break;case"insertAfter":t.insertAdjacentHTML("afterend",e.content);break}})}observeHistoryState(){window.onpopstate=()=>{this.contents=this.extractMatchedContents(this.contentsResponse.contents),this.applyContents()}}}typeof window!="undefined"&&window.AttachmentConfig&&new n(window.AttachmentConfig).run(),s.AttachmentCMS=n,Object.defineProperty(s,"__esModule",{value:!0}),s[Symbol.toStringTag]="Module"});
